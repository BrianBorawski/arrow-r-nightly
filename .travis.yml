language: r
os: osx
cache: packages
r:
- 3.2
- 3.3
- 3.4
- oldrel
- release
# CRAN doesn't host macOS binary packages for r-devel
# - devel
env:
  LOCAL_AUTOBREW: "TRUE"
  TEST_R_WITH_ARROW: "TRUE"
before_install:
- git clone --depth=1 https://github.com/apache/arrow.git
- cd arrow/r
- git log -n 1 # To show what commit is being built
# This script used to be inside r/tools/ but was moved
- cp ../dev/tasks/homebrew-formulae/autobrew/apache-arrow.rb tools/apache-arrow.rb
# HACK to disable S3 for now
- sed -i.bak -E -e "s/ARROW_S3=ON/ARROW_S3=OFF/" tools/apache-arrow.rb
- rm -f tools/apache-arrow.rb.bak
- source ../../up-date-description.sh
script:
# Use a custom "script" to add travis_wait in order to prevent build timeouts
- travis_wait R CMD build .
- travis_wait R CMD check arrow_*.tar.gz --as-cran --install-args="--build"
after_success:
- test $TRAVIS_R_VERSION_STRING = "release" && travis_wait Rscript -e 'covr::codecov()'
- source ../../bintray-upload.sh
